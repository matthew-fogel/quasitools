<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>consensus - quasitools</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../stylesheets/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "consensus";
    var mkdocs_page_input_path = "consensus.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> quasitools</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../requirements/">Requirements</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../installation/">Installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../formats/">Data Formats</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tools</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../aacoverage/">aacoverage</a>
                </li>
                <li class="">
                    
    <a class="" href="../aavar/">call aavr</a>
                </li>
                <li class="">
                    
    <a class="" href="../codonvar/">call codonvar</a>
                </li>
                <li class="">
                    
    <a class="" href="../ntvar/">call ntvar</a>
                </li>
                <li class="">
                    
    <a class="" href="../complexity/">complexity</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">consensus</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#consensus">Consensus</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#basic-usage">Basic Usage</a></li>
        
            <li><a class="toctree-l4" href="#arguments">Arguments</a></li>
        
            <li><a class="toctree-l4" href="#options">Options</a></li>
        
            <li><a class="toctree-l4" href="#output_1">Output</a></li>
        
            <li><a class="toctree-l4" href="#example">Example</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../distance/">distance</a>
                </li>
                <li class="">
                    
    <a class="" href="../dnds/">dnds</a>
                </li>
                <li class="">
                    
    <a class="" href="../drmutations/">drmutations</a>
                </li>
                <li class="">
                    
    <a class="" href="../hydra/">hydra</a>
                </li>
                <li class="">
                    
    <a class="" href="../quality/">quality</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../contact/">Contact</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../legal/">Legal</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">quasitools</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tools &raquo;</li>
        
      
    
    <li>consensus</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="consensus">Consensus</h1>
<p>Generate a consensus sequence from a BAM file. With default settings, a simple majority base rule will be used to build the consensus. However, the user may specify a minimum percentage of abundance for base incorporation into the consensus sequence, which may produce IUPAC codes in the consensus.</p>
<h2 id="basic-usage">Basic Usage</h2>
<pre><code class="bash">quasitools consensus [options] &lt;BAM file&gt; &lt;reference file&gt;
</code></pre>

<h2 id="arguments">Arguments</h2>
<h3 id="bam-file">BAM File</h3>
<p>A <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">BAM</a> file (.bam) of sequences aligned to a related reference. A BAM index file (.bai) is also required and should be named the same as the BAM file, with the extension instead changed from ".bam" to ".bai".</p>
<h3 id="reference-file">Reference File</h3>
<p>A reference file related to the aligned BAM sequences. The provided reference file must be the same reference file used when producing the BAM and BAM index files.</p>
<h2 id="options">Options</h2>
<h3 id="percentage">Percentage</h3>
<pre><code class="text">-p, --percentage INTEGER
</code></pre>

<p>This percentage option causes the consensus tool to operate in one of two distinct modes. When the percentage is set to exactly <code>100</code>, then the consensus is generated using by taking the most abundant base at each position. In contrast, when the percentage is less than <code>100</code>, then the consensus is generated by comparing the frequency of each base at a position against the treshold. The default value is <code>100</code>. These two modes of operation are described in greater detail below.</p>
<p>When this percentage is set to exactly <code>100</code>, then the most frequent base will be incorporated into the consensus sequence. The incorporated base will be the most abundant base at the position. In the case of a tie, the base will be chosen in reverse alphabetical order. When no base is present (zero coverage, inserstion, only <code>N</code>), then an ambigious <code>N</code> base will be incorporated. Additionally, insertions that are at least a multiple of 3 (i.e. codon length) will be incorporated.</p>
<p>When this percentage is less than <code>100</code>, then the tool will determine how many different bases pass the minimum incorporation threshold (<code>percentage</code>) at each position. Any bases that exceed this threshold will be incorporated into the consensus sequence at the given position. When multiple bases exceed the minimum threshold, then the base is converted to an ambigious IUPAC base. A table outlining these conversation is found below:</p>
<table>
<thead>
<tr>
<th>Bases Exceeding Treshold</th>
<th>Incorporated Base</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>A</td>
</tr>
<tr>
<td>C</td>
<td>C</td>
</tr>
<tr>
<td>G</td>
<td>G</td>
</tr>
<tr>
<td>T</td>
<td>T</td>
</tr>
<tr>
<td>AC</td>
<td>M</td>
</tr>
<tr>
<td>AG</td>
<td>R</td>
</tr>
<tr>
<td>AT</td>
<td>W</td>
</tr>
<tr>
<td>CG</td>
<td>S</td>
</tr>
<tr>
<td>CT</td>
<td>Y</td>
</tr>
<tr>
<td>GT</td>
<td>K</td>
</tr>
<tr>
<td>ACG</td>
<td>V</td>
</tr>
<tr>
<td>ACT</td>
<td>H</td>
</tr>
<tr>
<td>AGT</td>
<td>D</td>
</tr>
<tr>
<td>CGT</td>
<td>B</td>
</tr>
<tr>
<td>ACGT</td>
<td>N</td>
</tr>
</tbody>
</table>
<p>For example, if the <code>percentage</code> is <code>20</code> and <code>A</code> has been observed 30% of the time, <code>G</code> has been observed 30% of the time, and <code>T</code> has been observed 40% of the time, then the base incorporated into the consensus will be <code>D</code>. However, when there is zero coverage, or no bases meet the percentage threshold an ambigious <code>N</code> base will be incorporated into the consensus. Insertions will not be inserted into the consensus when run in this mode of operation.</p>
<h3 id="id">ID</h3>
<pre><code class="text">-i, --id TEXT
</code></pre>

<p>Specify the default FASTA sequence identifier to be used for sequences without an RG tag.</p>
<h3 id="output">Output</h3>
<pre><code class="text">-o, --ouput FILENAME
</code></pre>

<p>The file output location for the generated consensus sequence.</p>
<h2 id="output_1">Output</h2>
<p>A consensus sequence on FASTA fortmat will be output to standard out unless specified otherwise.</p>
<h2 id="example">Example</h2>
<h3 id="data">Data</h3>
<p>The following example data may be used to run the tool:</p>
<ul>
<li><a href="../data/variant.bam">variant.bam</a></li>
<li><a href="../data/variant.bai">variant.bai</a></li>
<li><a href="../data/hiv.fasta">hiv.fasta</a></li>
</ul>
<h3 id="command">Command</h3>
<pre><code class="bash">quasitools consensus variant.bam hiv.fasta
</code></pre>

<h3 id="output_2">Output</h3>
<pre><code class="text">&gt;variant_100_AF033819.3
ACTCTGGTAACTAGAGATCCCTCAGACCCATTTAGTCAGTGTGGAAAATCTCTAGCAGTGGCGCCCGAACAGGGACCTGA
AAGCGAAAGGGAAACCAGAGGAGCTCTCTCGACGCAGGACTCGGCTTGCTGAAGCGCGCACGGCAAGAGGCGAGGGGCGG
CGACTGGTGAGTACGCCAAAAATTTTGACTAGCGGAGGCTAGAAGGAGAGAGATGGGTCCGAGAGCGTCAGTATTAAGCG
GGGGAGAATTAGATCGATGGGAAAAAATTCGGTTAAGGCCAGGGGGAAAGAAAAAATATAAATTAAAACATATAGTATGG
GCAAGCAGGGAGCTAGAACGATTCGCAGTTAATCCTGGCCTGTTAGAAACATCAGAAGGCTGTAGACAAATACTGGGACA
GCTACAACCATCCCTTCAGACAGGATCAGAAGAACTTAGATCATTATATAATACAGTAGCAACCCTCTATTGTGTGCATC

(output truncated)
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../distance/" class="btn btn-neutral float-right" title="distance">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../complexity/" class="btn btn-neutral" title="complexity"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright Government of Canada 2017-2018</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../complexity/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../distance/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
